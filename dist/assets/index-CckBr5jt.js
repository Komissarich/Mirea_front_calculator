(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const u=JSON.parse(localStorage.getItem("calcHistory")||"[]"),e={firstNumber:null,operator:null,secondNumber:null,waitingForSecondNumber:!1},c=document.querySelector(".expression"),f=document.querySelectorAll(".buttons button"),l=document.getElementById("history-modal"),p=document.getElementById("history-btn"),N=document.getElementById("clear-history");p.addEventListener("click",()=>{l.classList.add("active"),m()});l.addEventListener("click",t=>{t.target===l&&l.classList.remove("active")});for(let t of f)t.addEventListener("click",r=>{g(r.currentTarget)});N.addEventListener("click",()=>{u.length=0,localStorage.removeItem("calcHistory"),l.classList.remove("active"),m()});function g(t){if(t.classList.contains("number"))e.operator===null?e.firstNumber===null?e.firstNumber=t.textContent:e.firstNumber.includes(".")?e.firstNumber+=t.textContent:e.firstNumber=(parseFloat(e.firstNumber)*10+parseInt(t.textContent)).toString():e.secondNumber===null?e.secondNumber=t.textContent:e.secondNumber.includes(".")?e.secondNumber+=t.textContent:e.secondNumber=(parseFloat(e.secondNumber)*10+parseInt(t.textContent)).toString();else if(t.classList.contains("operation"))if(t.name==="clear")e.firstNumber=null,e.operator=null,e.secondNumber=null;else if(t.name==="solve"){if(e.firstNumber&&e.operator&&e.secondNumber){let r=b(parseFloat(e.firstNumber),e.operator,parseFloat(e.secondNumber));y(e.firstNumber+" "+e.operator+" "+e.secondNumber,r),r?e.firstNumber=r.toString():e.firstNumber=r?.toString()??"Error",e.operator=null,e.secondNumber=null}}else if(t.name==="fraction")e.secondNumber===null&&e.firstNumber!==null&&!e.firstNumber.includes(".")?e.firstNumber+=".":e.secondNumber!==null&&(e.secondNumber+=".");else if(e.firstNumber===null){const r=document.getElementById("buttons");r.classList.add("pulse"),r.addEventListener("animationend",function s(){r.classList.remove("pulse"),r.removeEventListener("animationend",s)})}else e.operator===null&&(e.operator=t.textContent);d()}function d(){const t=[e.firstNumber];e.operator&&t.push(e.operator),e.secondNumber!==null&&t.push(e.secondNumber),e.firstNumber==="null"?(c.textContent="NaN",e.firstNumber=null):(c.textContent=t.join(" "),c.textContent===""&&(c.textContent="0"))}function b(t,r,s){switch(r){case"+":return t+s;case"-":return t-s;case"*":return t*s;case"/":return s===0?null:t/s;case"^":return Math.pow(t,s);case"%":return t%s;default:return s}}function y(t,r){const o=new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),n={expression:t,result:r?.toString()??"Error",timestamp:o};u.unshift(n),localStorage.setItem("calcHistory",JSON.stringify(u)),m()}function m(){const t=document.getElementById("history-list");t.innerHTML=u.map(r=>{const s=r.expression;return`
        <div class="history-item" data-expression="${s}">
          <span class="expr">${s} =</span>
          <span class="result">${r.result}</span>
          <small class="time">${r.timestamp}</small>
        </div>
      `}).join("")}document.getElementById("history-list").addEventListener("click",t=>{const r=t.target.closest(".history-item");if(!r)return;const s=r.getAttribute("data-expression");if(!s)return;const o=s.trim().split(" ");console.log(o),o.length!==3?(e.firstNumber=o[0],e.operator=null,e.secondNumber=null):(e.firstNumber=o[0],e.operator=o[1],e.secondNumber=o[2]),e.waitingForSecondNumber=!1,l.classList.remove("active"),d()});
